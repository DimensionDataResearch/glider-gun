services:
  - docker:dind

stages:
  - build
  - package

build:
 image: microsoft/dotnet:1.1.2-sdk
 stage: build
 script:
  - 'dotnet restore'
  - 'dotnet build -c Release'
  - 'dotnet publish -c Release'
  - mkdir dotnetapp
  - cp -rf src/GliderGun.Api/bin/Release/netcoreapp1.1/publish/ dotnetapp/
 only:
   - master
 artifacts:
  paths:
    - dotnetapp/

package:
  image : docker:latest
  dependencies:
   - build
  stage: package
  script:
   - ls
   - 'docker build -t dd/managecompute/glider-gun-api -t dd/managecompute/glider-gun-api:stable -f docker-images\glider-gun-api\Dockerfile .'
  only:
    - master